<?php


/**
 * Implements hook_views_api().
 */
function draggableviews_views_api() {
  return array(
    'api' => 3,
    'path' => drupal_get_path('module', 'draggableviews') . '/views',
  );
}

/**
 * Implementes hook_preprocess_views_view_table().
 */
function draggableviews_preprocess_views_view_table(&$vars) {
  // Check whether this table view has draggableview field.
  if (!isset($vars['view']->field['draggableviews'])) {
    return;
  }

  // Add table class.
  $vars['classes_array'][] = 'draggable';

  // Add row class.
  foreach ($vars['row_classes'] as &$row_classes) {
    $row_classes[] = 'draggable';
  }

  // TODO: Change to more unique id.
  $vars['attributes_array']['id'] = 'draggableviews-table';
  // Add javascript.
  drupal_add_tabledrag('draggableviews-table', 'order', 'sibling', 'draggableviews-weight');
}

/**
 * Implements hook_views_form_submit().
 */
function draggableviews_views_form_submit($form, &$form_state) {
  $fv = $form_state['values'];
  dpm($fv);
}